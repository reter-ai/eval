test_begin("static methods");

// --- Statics-only class (namespace/utility) ---
define Math = constructor()
    static(PI: 3.14159, sqrt: function(x) x ** 0.5, double: function(x) x * 2)
    interface();

test("statics-only: static value access", 3.14159, Math->PI);
test("statics-only: static method call", 2.0, Math->sqrt(4));
test("statics-only: another static method", 10, Math->double(5));

// --- Statics + interface (full class) ---
define Point = constructor(x, y)
    static(origin: function() Point(0, 0))
    interface(x: x, y: y);

test("statics+iface: construction x", 3, Point(3, 4)->x);
test("statics+iface: construction y", 4, Point(3, 4)->y);
test("statics+iface: static method", 0, Point->origin()->x);
test("statics+iface: chained call", 0, Point->origin()->y);

// --- Static values (non-functions) ---
define Config = constructor()
    static(version: 42, name: "MyApp")
    interface();

test("static non-fn: int", 42, Config->version);
test("static non-fn: string", "MyApp", Config->name);

// --- Statics accessible from instances ---
define Counter = constructor(n)
    static(default_start: 0, make: function(x) Counter(x))
    interface(n: n);

define c = Counter(10);
test("instance: field access", 10, c->n);
test("instance: static from instance", 0, c->default_start);
test("instance: static method from instance", 42, c->make(42)->n);

// --- Normal construction works alongside statics ---
test("construction: via static make", 7, Counter->make(7)->n);
test("construction: direct", 99, Counter(99)->n);

// --- Inheritance with super + statics ---
define Animal = constructor(name)
    static(kingdom: "Animalia")
    interface(name: name, speak: function() "...");

define Dog = constructor(name, breed)
    static(species: "Canis lupus")
    interface(breed: breed, speak: function() "Woof!");

test("inherit: child static", "Canis lupus", Dog->species);
test("inherit: child field", "Lab", Dog("Rex", "Lab")->breed);
test("inherit: overridden method", "Woof!", Dog("Rex", "Lab")->speak());

// --- Inheritance with super inside block + statics ---
define Cat = constructor(name, color)
    static(species: "Felis catus")
    interface(color: color);

test("inherit: block child static", "Felis catus", Cat->species);
test("inherit: block child field", "orange", Cat("Whiskers", "orange")->color);

// --- Chained calls ---
define p2 = Point(1, 2);
test("chain: static from instance", 0, p2->origin()->y);

test_end();
