/*
 * _lark_codegen.h â€” Code generation from LarkGrammar to C source.
 *
 * Converts a parsed Lark grammar into:
 *   1. A lemon .y grammar string (BNF + AST-building reduce actions)
 *   2. A re2c .re lexer input string (DFA-based token scanner)
 *   3. A combined C source ready for JIT compilation
 */
#ifndef LARK_CODEGEN_H
#define LARK_CODEGEN_H

#include "_lark_parser.h"

#ifdef __cplusplus
extern "C" {
#endif

/* Desugar parenthesized groups (LARK_ITEM_GROUP) into synthetic inline rules.
 * Must be called before lark_generate_lemon_y(). */
void lark_desugar_groups(LarkGrammar* grammar);

/* Generate a lemon .y grammar string from a LarkGrammar.
 * Includes AST-building reduce actions.
 * The parser_prefix (e.g. "Grammar42") is used for %name directive.
 * Returns malloc'd string. Caller frees. */
char* lark_generate_lemon_y(LarkGrammar* grammar, const char* parser_prefix);

/* Generate a re2c .re format source string from a LarkGrammar.
 * The output contains a re2c block that re2c compiles into
 * DFA-based switch/case code. Pass the result to re2c_lib_compile().
 * Returns malloc'd string. Caller frees. */
char* lark_generate_re2c_re(LarkGrammar* grammar, const char* func_prefix);

/* Generate the complete combined C source for JIT compilation.
 *
 * Combines:
 *   1. AST template (arena allocator, AstNode, helpers)
 *   2. Lexer (from re2c)
 *   3. Parser (from lemon)
 *   4. Glue: parse function that ties lexer + parser together
 *
 * parser_c:  generated by lemon_lib_compile()
 * parser_h:  generated by lemon_lib_compile()
 * lexer_c:   generated by re2c_lib_compile()
 * func_prefix: e.g. "grammar_42"
 *
 * Returns malloc'd string. Caller frees. */
char* lark_generate_combined_c(LarkGrammar* grammar,
                                const char* parser_c,
                                const char* parser_h,
                                const char* lexer_c,
                                const char* func_prefix);

#ifdef __cplusplus
}
#endif

#endif /* LARK_CODEGEN_H */
